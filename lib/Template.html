<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" type="text/css" href="$TEMPLATE_CSS_URL">
  <base href="$TEMPLATE_BASE_URL" target="_blank">
  <script type="text/javascript">
      const __setInnerHTML = (selector, html) => {
          document.querySelector(selector).innerHTML = html
          return true
      }
      const __configurationProjectMouseOver = (e) => {
          e.classList.add('menu_highlighted')
          e.querySelectorAll('div.right_project_menu').forEach(e => e.style.visibility = 'visible')
          return true
      }
      const __configurationProjectMouseOut = (e) => {
          e.classList.remove('menu_highlighted')
          e.querySelectorAll('div.right_project_menu').forEach(e => e.style.visibility = 'hidden')
          return true
      }
      const __setPhabricatorUrl = (url) => {
        document.querySelector('input[name=phabricator_url]').value = url
        return true
      }
      const __setPhabricatorToken = (token) => {
        document.querySelector('input[name=phabricator_token]').value = token
        return true
      }
      const __showTickets = () => {
        document.querySelector('div.projects_tickets').style.visibility = 'visible'
        return true
      }
      const __hideTickets = () => {
        document.querySelector('div.projects_tickets').style.visibility = 'hidden'
        return true
      }
      const __showModalOverlay = () => {
        document.querySelector('div.modal_overlay').style.display = 'block'
        return true
      }
      const __hideModalOverlay = () => {
        document.querySelector('div.modal_overlay').style.display = 'none'
        return true
      }
      const __hideProjectSearch = () => {
        document.querySelector('div.projects_search_centered_panel').style.display = 'none'
        return true
      }
      const __showProjectSearch = (mode, hideButtonHTML, title) => {
        document.querySelector('div.projects_search_centered_panel').style.display = 'block';
        document.querySelector('div.projects_search_hide_container').innerHTML = hideButtonHTML;
        document.querySelector('div.projects_search_title').innerHTML = title;
        document.querySelector('input#projects_search_mode').value = mode;
        return true
      }
      const __resetProjectSearch = () => {
        document.querySelector('input#projects_search_mode').value = '';
        document.querySelector('input.projects_search_textbox').value = '';
        document.querySelector('div.projects_search_results').innerHTML = '';
        return true
      }
      const __deleteMenu = (buttonID) => {
        const thisButton = document.querySelector(`button#$${buttonID}`);
        const menuDiv = thisButton.closest('div.menu');
        menuDiv.remove()
        return true
      }
      const __toggleButton = (buttonID) => {
        if (document.querySelector(`button#$${buttonID}`).classList.contains('selected')) {
            document.querySelector(`button#$${buttonID}`).classList.remove('selected')
        } else {
            document.querySelector(`button#$${buttonID}`).classList.add('selected')
        }
        return true
      }
      const __getComment = (ticketID) => {
        return document.querySelector(`textarea#ticketID$${ticketID}`).value
      }
      const __setComment = (ticketID, comment) => {
        const textArea = document.querySelector(`textarea#ticketID$${ticketID}`)
        textArea.value = comment
        return textArea.value
      }
      const __deselectOtherButtonsInMenu = (buttonID) => {
        const thisButton = document.querySelector(`button#$${buttonID}`)
        const menu = thisButton.closest('buttonmenu')
        if (thisButton.parentElement != menu) {
            pywebview.api.printDebug("Closest 'buttonmenu' tag is not button tag's parent")
        }
        menu.querySelectorAll('button').forEach(button => {
            if (button.id == thisButton.id) return
            button.classList.remove('selected')
        })
        return true
      }
      const __setTicketActionMessage = (ticketID, message) => {
        const span = document.querySelector(`span#buttonActionMessage$${ticketID}`)
        span.innerHTML = message
        setTimeout(() => {{ span.innerHTML = '' }}, 1500)
        return true
      }
      const __isButtonSelected = (buttonID) => {
        return document.querySelector(`button#$${buttonID}`).classList.contains('selected')
      }
      const __selectButton = (buttonID) => {
        document.querySelector(`button#$${buttonID}`).classList.add('selected')
        return true
      }
  </script>
</head>
<body>

  <div class="phabricator-remarkup">

    <div class=projects_configuration>
      <div class=projects_configuration_header>
          <div class=projects_configuration_title>
              <b>⚙️&nbsp;&nbsp;Current Configuration</b>
              <div id=projects_configuration_body_buttons class=projects_configuration_body_buttons>
              </div>
              <div class=projects_configuration_textboxes>
                <input type="text" name="phabricator_url" placeholder="Your Phabricator URL"
                onchange="pywebview.api.textboxTermEntered(this.value, 'url');"
                onpaste="this.onchange();"
                oninput="this.onchange();"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                >
                <input type="password" name="phabricator_token" placeholder="Your Conduit Token"
                onchange="pywebview.api.textboxTermEntered(this.value, 'token');"
                onpaste="this.onchange();"
                oninput="this.onchange();"
                autocomplete="off"
                autocorrect="off"
                autocapitalize="off"
                spellcheck="false"
                >
              </div>
          </div>
      </div>
      <div class=projects_configuration_body>
          <div class=project_configuration_heading onmouseover="__configurationProjectMouseOver(this)"  onmouseout="__configurationProjectMouseOut(this)">
              <div id=sources_right_menu class=right_project_menu></div>
              <span class="project_configuration_title">Ticket Sources:</span>
              <span class="project_configuration_description">Tickets are shown from the project columns selected here.</span>
          </div>
          <div id=projects_configuration_sources>
          </div>
          <div class=project_configuration_heading onmouseover="__configurationProjectMouseOver(this)"  onmouseout="__configurationProjectMouseOut(this)">
              <div id=destination_right_menu class=right_project_menu></div>
              <span class="project_configuration_title">Ticket Destination Columns:</span>
              <span class="project_configuration_description"> Optional. A menu of columns selected from this project will appear within each ticket's "<b>Quick options</b>".</span>
          </div>
          <div id=projects_configuration_destination>
          </div>
      </div>
    </div>

    <div class=projects_tickets>
    </div>

    <div class="modal_overlay" onclick="this.style.display = 'none'; document.querySelector('div.projects_search_centered_panel').style.display = 'none';"></div>
    <div class="projects_search_centered_panel">
      <div class="projects_search_hide_container">
      </div>
      <div class="projects_search_title">
      </div>
      <form>
        <input type="hidden" id="projects_search_mode">
        <input type="text"
          class="projects_search_textbox"
          placeholder="Enter project title search term here"
          onchange="pywebview.api.projectSearchTermEntered(this.value, document.querySelector('input#projects_search_mode').value);"
          onpaste="this.onchange();"
          oninput="this.onchange();"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        >
      </form>
      <div class="projects_search_results">
      </div>
    </div>

  </div>
</body>
</html>
